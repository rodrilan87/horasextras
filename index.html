<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA CONTROL OSDE</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 400px; border-top: 6px solid #003057; }
        h2 { text-align: center; color: #003057; margin-bottom: 1.5rem; }
        input { width: 100%; padding: 12px; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 12px; background: #003057; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.3s; }
        button:hover { background: #0056b3; }
        .toggle-link { text-align: center; margin-top: 1.2rem; font-size: 0.9rem; color: #0076BE; cursor: pointer; text-decoration: underline; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="login-card">
    <h2 id="form-title">Iniciar Sesión</h2>
    
    <div id="login-form">
        <input type="email" id="l_email" placeholder="Email (@osde.com.ar)">
        <input type="password" id="l_pass" placeholder="Contraseña">
        <button onclick="app.login()">ENTRAR</button>
        <p class="toggle-link" onclick="app.showReg()">¿No tienes cuenta? Regístrate</p>
    </div>

    <div id="reg-form" class="hidden">
        <input type="text" id="r_name" placeholder="Nombre completo">
        <input type="email" id="r_email" placeholder="Email @osde.com.ar">
        <input type="password" id="r_pass" placeholder="Crear contraseña">
        <button onclick="app.register()">CREAR CUENTA</button>
        <p class="toggle-link" onclick="app.showLogin()">Volver al inicio</p>
    </div>
</div>

<script>
    // IMPORTANTE: Pon aquí tu URL de implementación (la que termina en /exec)
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxia_lBeBQIEDAw0NglfW4YQliWwKfzMbICXwa1ZpqzGTcbMhlOT4tH4p0uH_C3rXhavA/exec";

    const app = {
        async login() {
            const email = document.getElementById('l_email').value.toLowerCase().trim();
            const pass = document.getElementById('l_pass').value;

            // 1. Acceso Directo Admin (Según tus instrucciones)
            if (email === "rodri@gmx.com" && pass === "1234") {
                alert("Acceso concedido: Administrador Rodrigo");
                // Aquí activaremos la interfaz de jefe en el próximo paso
                return;
            }

            // 2. Acceso Usuarios OSDE desde la planilla
            try {
                const response = await fetch(WEB_APP_URL);
                const data = await response.json();
                
                // Buscamos si existe el usuario con esa clave
                const user = data.find(row => row[0] === "USER" && row[2] === email && String(row[3]) === pass);

                if (user) {
                    alert("Hola " + user[1] + ". Has ingresado correctamente.");
                } else {
                    alert("Email o contraseña no válidos.");
                }
            } catch (e) {
                alert("Error de conexión: Verifica que la URL del script sea correcta y esté publicada.");
            }
        },

        async register() {
            const name = document.getElementById('r_name').value.trim();
            const email = document.getElementById('r_email').value.toLowerCase().trim();
            const pass = document.getElementById('r_pass').value;

            // Restricción de dominio
            if (!email.endsWith("@osde.com.ar")) {
                alert("Error: Solo se permiten correos @osde.com.ar");
                return;
            }

            if (!name || !pass) return alert("Completa todos los campos.");

            const payload = { type: "registro", nombre: name, email: email, password: pass };

            try {
                // Envío de datos a Google Sheets
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(payload)
                });
                alert("¡Registro enviado! Ya puedes iniciar sesión.");
                this.showLogin();
            } catch (e) {
                alert("Error al intentar registrar.");
            }
        },

        showReg() {
            document.getElementById('form-title').innerText = "Nuevo Usuario";
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('reg-form').classList.remove('hidden');
        },
        showLogin() {
            document.getElementById('form-title').innerText = "Iniciar Sesión";
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('reg-form').classList.add('hidden');
        }
    };
</script>
</body>
</html>
