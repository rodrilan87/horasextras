<!DOCTYPE html>
<html>
<body>

<h2>Login</h2>
<input id="email" placeholder="email">
<input id="clave" type="password" placeholder="clave">
<button onclick="login()">Entrar</button>
<button onclick="registro()">Registrarse</button>

<hr>

<div id="app" style="display:none">
  <h3>Cargar horas</h3>
  <input type="date" id="fecha">
  <input type="time" id="desde">
  <input type="time" id="hasta">
  <select id="porcentaje">
    <option>50%</option>
    <option>100%</option>
  </select>
  <input id="tk" placeholder="TK / ID">
  <textarea id="sug" maxlength="50"></textarea>
  <button onclick="cargar()">Guardar</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzy8xVrUNVga9WADMqpIUrvIWenQqEZt--vJEZtGTXjNLT2tk-p21BYMwCWOJtjqxA0vQ/exec";
let ROL = "";

function login() {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "login",
      email: email.value,
      clave: clave.value
    })
  }).then(r => r.json()).then(d => {
    if (d.ok) {
      ROL = d.rol;
      app.style.display = "block";
      alert("Login OK - " + ROL);
    } else alert(d.error);
  });
}

function registro() {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "register",
      email: email.value,
      clave: clave.value
    })
  }).then(r => r.json()).then(alert);
}

function cargar() {
  const horas =
    (new Date(`1970-01-01T${hasta.value}`) -
     new Date(`1970-01-01T${desde.value}`)) / 3600000;

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "cargarHoras",
      rol: ROL,
      email: email.value,
      fecha: fecha.value,
      desde: desde.value,
      hasta: hasta.value,
      horas,
      porcentaje: porcentaje.value,
      sugerencia: sug.value,
      tk: tk.value
    })
  }).then(r => r.json()).then(alert);
}
</script>

</body>
</html>

